# app.py

import streamlit as st
import pandas as pd
import joblib

# 1. CARGAR COMPONENTES
try:
    model = joblib.load("modelo_churn_final.pkl")
    scaler = joblib.load("scaler_minmax.pkl")
    column_names = joblib.load("columnas_entrenamiento.pkl")
except:
    st.error("Error al cargar archivos del modelo.")
    st.stop()

# 2. FUNCIÓN DE PREPROCESAMIENTO (LA CLAVE)
def preprocess_input(input_df, scaler_obj, column_list):
    # Aquí va TODO el código que hiciste en la Etapa 6 de Interacción con el Modelo
    # 1. Codificación Binaria (Yes/No a 1/0)
    # 2. One-Hot Encoding (pd.get_dummies del input_df)
    # 3. Alineación de columnas con column_list y fill_value=0
    # 4. Aplicar scaler_obj.transform()
    return final_processed_df

# 3. INTERFAZ DE STREAMLIT
st.title("Predicción de Churn de Clientes Telco")

# Ejemplo de un widget de entrada
gender = st.selectbox("Género", ["Female", "Male"])
tenure = st.slider("Meses de Permanencia (Tenure)", 1, 72, 10)
contract = st.selectbox("Tipo de Contrato", ["Month-to-month", "One year", "Two year"])

# ... (más inputs para las 20 variables) ...

if st.button("Predecir Churn"):
    # 4. CONSTRUIR DATAFRAME DE ENTRADA
    input_data = pd.DataFrame({
        'gender': [gender],
        'tenure': [tenure],
        'Contract': [contract],
        # ... (todas las variables faltantes) ...
    })

    # 5. PREPROCESAR Y PREDECIR
    processed_data = preprocess_input(input_data, scaler, column_names)
    probability = model.predict_proba(processed_data)[0][1]

    # 6. MOSTRAR RESULTADOS
    st.metric("Probabilidad de Abandono (Churn)", f"{probability*100:.2f}%")
